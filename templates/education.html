<!DOCTYPE html>
<html lang="en">

<style>
  * {
    box-sizing: border-box;
  }

  body {
    font-family: Arial, Helvetica, sans-serif;
    margin: 0;
    width: 100%;
  }

  .head {
    width: 100%;
    height: 20%;
    padding: 10px;
  }

  .logo {
    width: 20%;
    height: 100%;
    padding: 10px;
    /* background-color: azure; */
    float: left;
  }

  .name {
    width: 60%;
    height: 100%;
    padding: 10px;
    /* background-color: antiquewhite; */
    float: left;
    position: relative;
    left: 10%;
  }

  .navbar {
    overflow: hidden;
    background-color: #204F6D;
    width: 100%;
    height: 30%;
    padding-left: 7%;
  }

  /* Style the navigation bar links */
  .func {
    float: left;
    display: block;
    color: white;
    text-align: center;
    padding-top: 1.5%;
    padding-bottom: 1.5%;
    padding-left: 4.5%;
    padding-right: 4.5%;
    text-decoration: none;
    font-size: 20px;
    cursor: pointer;
  }

  /* Change color on hover */
  .func:hover {
    background-color: #ddd;
    color: black;
  }

  .table {
    text-align: center;
    padding-top: 20px;
    width: 100%;

  }

  .table_title {
    font-size: 20px;
    text-align: center;
    padding-bottom: 20px;
  }

  .table_data {
    font-size: 18px;
    margin-left: auto;
    margin-right: auto;
  }

  .download {
    cursor: pointer;
    color: darkblue;
    font-size: 20px;
    padding-left: 10%;
    font-weight: bold;
    /* width: 30%; */
  }

  .download:hover {
    text-decoration: underline;
  }

  .canvas {
    margin: auto;
    width: 80%;
    background-color: white;
  }

  .adjust {
    width: 70%;
    padding-left: 32%;
    text-align: center;
    font-size: 18px;

  }

  .cells {
    text-align: right;
    font-size: 18px;
    padding-right: 20%;

  }
</style>

<head>
  <meta charset="UTF-8">
  <title>Search Result</title>
</head>
<!-- Connect to Chart.js for visulization -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
<!-- Initial function, reset value, check category -->

<body>
  <div class="head">
    <img class="logo" src="/static/img/logo.png" />
    <div class="name">
      <h1>Community Needs Assessment Data Tool</h1>
    </div>
  </div>

  <div class="navbar">
    <a href="/">
      <div class="func">Home</div>
    </a>
    <a href="/searchCounty">
      <div class="func">Back to Search Page</div>
    </a>
  </div>

  <div class="main">

    <p class="download" onclick="download_csv();">Download data as a .csv file</p>
    <!-- Create table for data retrived -->
    <div class="table">
      <div class="table_title">Search results for {{county}}, {{state}}:</div>
      <div>
        {% if result_list %}
        <table class="table_data" , border="1px">
          <th>Category</th>
          <th>Variable</th>
          <th>Year</th>
          <th>County Data</th>
          <th>State Data</th>
          {% for line in result_list %}
          <tr>
            <td>{{line[0]}}</td>
            <td>{{line[1]}}</td>
            <td>{{line[2]}}</td>
            <td>{{line[3]}}</td>
            <td>{{line[4]}}</td>
          </tr>
          {% endfor %}
        </table>
        {% endif %}
      </div>
    </div>
    <br>
    <br>
    <div class="adjust">
      <a>You can personalize charts' color here</a><br>
      <a>Put the RGB code into cells below and click "Update Color"</a><br>
      <a>Color codes should start with # and has 6 letters or numbers</a><br>
      <a>e.g. #CCCFFF</a><br>
      <a>Refer to <a href="https://www.rapidtables.com/web/color/RGB_Color.html">this tool page</a> to find color
        codes</a><br><br>
      <div class="cells">
        <a>Less than 9th grade</a>
        <input type="text" id="color1"><br>
        <a>9th - 12th grade, no diploma</a>
        <input type="text" id="color2"><br>
        <a>High school graduate</a>
        <input type="text" id="color3"><br>
        <a>Some college, no degree</a>
        <input type="text" id="color4"><br>
        <a>Associate's degree</a>
        <input type="text" id="color5"><br>
        <a>Bachelor's degree</a>
        <input type="text" id="color6"><br>
        <a>Graduate or professional degree</a>
        <input type="text" id="color7"><br><br>
      </div>
      <button onclick="change_color()">Update Color</button>
      <br><br>
    </div>
    <!-- Draw visulization -->
    <p class="download" id="download1" onclick="download_img1()">Download the Figure Below</p><br>
    <div class="canvas">
      <canvas id="myChart1" width="1000" height="350" style="background-color:#ffffff;"></canvas>
    </div>
    <p class="download" id="download2" onclick="download_img2()">Download the Figure Below</p><br>
    <div class="canvas">
      <canvas id="myChart2" width="1000" height="350" style="background-color:#ffffff;"></canvas><br>
    </div>
  </div>


</body>

</html>

<script type="text/javascript">
  // Change data from python mode to json mode
  var result = {{ result_list| tojson }};
  var county = {{ county| tojson }};
  var state = {{ state| tojson }};
  var cate = result[0][0];
  var color_pool = Array("#d94e53", "#AADBD7", "#F2D579", "#529141", "#A66093", "#5a5a5a");

  const myChart1 = new Chart('myChart1', {
    type: 'bar',
    data: {
      labels: [result[0][2], result[1][2], result[2][2], result[3][2], result[4][2]],
      datasets: [
        {
          label: 'Less than 9th grade',
          data: [result[0][3], result[1][3], result[2][3], result[3][3], result[4][3]],
          backgroundColor: color_pool[0] // green
        },
        {
          label: '9th - 12th grade, no diploma',
          data: [result[5][3], result[6][3], result[7][3], result[8][3], result[9][3]],
          backgroundColor: color_pool[1]
        },
        {
          label: 'High school graduate',
          data: [result[10][3], result[11][3], result[12][3], result[13][3], result[14][3]],
          backgroundColor: color_pool[2]
        },
        {
          label: 'Some college, no degree',
          data: [result[15][3], result[16][3], result[17][3], result[18][3], result[19][3]],
          backgroundColor: color_pool[3]
        },
        {
          label: 'Associate\'s degree',
          data: [result[20][3], result[21][3], result[22][3], result[23][3], result[24][3]],
          backgroundColor: color_pool[4]
        },
        {
          label: 'Bachelor\'s degree',
          data: [result[25][3], result[26][3], result[27][3], result[28][3], result[29][3]],
          backgroundColor: color_pool[5]
        },
        {
          label: 'Graduate or professional degree',
          data: [result[30][3], result[31][3], result[32][3], result[33][3], result[34][3]],
          backgroundColor: color_pool[6]
        }
      ]
    },
    options: {
      responsive: false,
      title: {
        display: true,
        text: 'Educational attainment of population 25 years and older, county data',
        fontSize: 20,
      },
      scales: {
        yAxes: [{
          display: true,
          ticks: {
            beginAtZero: true
          }
        }]
      },
      legend: {
        position: 'right',
        labels: {
          fontSize: 16
        }
      },
      scales: {
        xAxes: [{ stacked: true }],
        yAxes: [{ stacked: true }]
      }
    }
  });
  const myChart2 = new Chart('myChart2', {
    type: 'line',
    data: {
      labels: [result[0][2], result[1][2], result[2][2], result[3][2], result[4][2]],
      datasets: [
        {
          label: 'Less than 9th grade',
          lineTension: 0,
          fill: false,
          data: [result[0][3], result[1][3], result[2][3], result[3][3], result[4][3]],
          borderColor: color_pool[0]
        },
        {
          label: '9th - 12th grade, no diploma',
          lineTension: 0,
          fill: false,
          data: [result[5][3], result[6][3], result[7][3], result[8][3], result[9][3]],
          borderColor: color_pool[1]
        },
        {
          label: 'High school graduate',
          lineTension: 0,
          fill: false,
          data: [result[10][3], result[11][3], result[12][3], result[13][3], result[14][3]],
          borderColor: color_pool[2]
        },
        {
          label: 'Some college, no degree',
          lineTension: 0,
          fill: false,
          data: [result[15][3], result[16][3], result[17][3], result[18][3], result[19][3]],
          borderColor: color_pool[3]
        },
        {
          label: 'Associate\'s degree',
          lineTension: 0,
          fill: false,
          data: [result[20][3], result[21][3], result[22][3], result[23][3], result[24][3]],
          borderColor: color_pool[3]
        },
        {
          label: 'Bachelor\'s degree',
          lineTension: 0,
          fill: false,
          data: [result[25][3], result[26][3], result[27][3], result[28][3], result[29][3]],
          borderColor: color_pool[4]
        },
        {
          label: 'Graduate or professional degree',
          lineTension: 0,
          fill: false,
          data: [result[30][3], result[31][3], result[32][3], result[33][3], result[34][3]],
          borderColor: color_pool[6]
        }
      ]
    },
    options: {
      responsive: false,
      title: {
        display: true,
        text: 'Change in educational attainment of population 25 years and older, county data',
        fontSize: 20,
      },
      scales: {
        yAxes: [{
          display: true,
          ticks: {
            beginAtZero: true
          }
        }]
      },
      legend: {
        position: 'right',
        labels: {
          fontSize: 16
        }
      }
    }
  });
  function download_img1() {
    var a = document.createElement('a');
    a.href = myChart1.toBase64Image();
    a.download = 'Chart1.png';
    a.click();
  }

  function download_img2() {
    var a = document.createElement('a');
    a.href = myChart2.toBase64Image();
    a.download = 'Chart2.png';
    a.click();
  }

  function download_csv() {
    // Add first line
    var csv = 'category,Variable,Year,State_Data,County_Data\n';
    // Add other lines
    result.forEach(function (row) {
      csv += row.join(',');
      csv += "\n";
    });
    // Download data
    console.log(csv);
    var hiddenElement = document.createElement('a');
    hiddenElement.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
    hiddenElement.target = '_blank';
    hiddenElement.download = cate + '_' + county + '_' + state + '' + '.csv';
    hiddenElement.click();
  }
  // Change color
  function change_color() {
    // read color
    var color1 = document.getElementById('color1').value;
    var color2 = document.getElementById('color2').value;
    var color3 = document.getElementById('color3').value;
    var color4 = document.getElementById('color4').value;
    var color5 = document.getElementById('color5').value;
    var color6 = document.getElementById('color6').value;
    var color7 = document.getElementById('color7').value;
    change_color1(color1, color2, color3, color4, color5, color6, color7);
    change_color2(color1, color2, color3, color4, color5, color6, color7);
  }

  // change color for first figures
  function change_color1(color1, color2, color3, color4, color5, color6, color7) {
    myChart1.data.datasets[0].backgroundColor = color1;
    myChart1.data.datasets[1].backgroundColor = color2;
    myChart1.data.datasets[2].backgroundColor = color3;
    myChart1.data.datasets[3].backgroundColor = color4;
    myChart1.data.datasets[4].backgroundColor = color5;
    myChart1.data.datasets[5].backgroundColor = color6;
    myChart1.data.datasets[6].backgroundColor = color7;
    myChart1.update();
    myChart1.update();
  }

  // Change color for second figures
  function change_color2(color1, color2, color3, color4, color5, color6, color7) {
    myChart2.data.datasets[0].borderColor = color1;
    myChart2.data.datasets[1].borderColor = color2;
    myChart2.data.datasets[2].borderColor = color3;
    myChart2.data.datasets[3].borderColor = color4;
    myChart2.data.datasets[4].borderColor = color5;
    myChart2.data.datasets[5].borderColor = color6;
    myChart2.data.datasets[6].borderColor = color7;
    myChart2.update();
  }

</script>